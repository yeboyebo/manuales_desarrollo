Instalacion

curl https://get.acme.sh | sh
source ~/.bashrc


Generar el certificado (primera vez)

acme.sh --issue --dns -d pruebas.yeboyebo.es --yes-I-know-dns-manual-mode-enough-go-ahead-please


acme.sh te mostrará algo como:


￼
Copy
￼
Download
Add the following TXT record:
Domain: '_acme-challenge.pruebas.yeboyebo.es'
TXT value: 'Xr4JZcF6pL9qW2sD8kT3mV7nB1yR0tH5eP0zQwE4vS9x'

Please add those TXT records to the DNS area.
Please check the DNS using DNS lookup tool, and wait 120 seconds for the propagation.


# Verificar propagación
dig TXT _acme-challenge.pruebas.yeboyebo.es +short
# comprobar si dominio apunta a la IP correcta
nslookup webapp.sanhigia.com

# Completar la verificación
acme.sh --renew -d pruebas.yeboyebo.es


# Verificar certificados instalados
acme.sh --list


# Redirección HTTP → HTTPS
server {
    listen 80;
    server_name webapp.sanhigia.com;
    return 301 https://$server_name$request_uri;
}

# Servidor HTTPS principal
server {
    listen 443 ssl;
    server_name webapp.sanhigia.com;
    
    # Certificados SSL desde acme.sh
    ssl_certificate /home/tu_usuario/.acme.sh/webapp.sanhigia.com_ecc/fullchain.cer;
    ssl_certificate_key /home/tu_usuario/.acme.sh/webapp.sanhigia.com_ecc/webapp.sanhigia.com.key;

    # Configuración SSL
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;

    # Tu aplicación
    root /var/www/quimera/apps/sanhigia/dist;
    index index.html;

    location / {
        try_files $uri /index.html;
    }

    # Para los challenges de renovación de Certbot
    location ^~ /.well-known/acme-challenge/ {
        root /var/www/html;
        allow all;
        default_type "text/plain";
    }
}

# Dar permisos de lectura al grupo www-data
chmod 644 ~/.acme.sh/pineboo.sanhigia.com_ecc/*
sudo chown -R $USER:www-data ~/.acme.sh/pineboo.sanhigia.com_ecc/

5. Verificar que funciona
curl -I https://pineboo.sanhigia.com
openssl s_client -connect pineboo.sanhigia.com:443 -servername pineboo.sanhigia.com